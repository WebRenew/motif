{
  "markdown": "[Vercel](https://vercel.com/) Slash [Workflow DevKit LogoWorkflow](https://useworkflow.dev/)\n\n- [Docs](https://useworkflow.dev/docs)\n- [Examples](https://github.com/vercel/workflow-examples)\n\n[X](https://x.com/workflowdevkit) [GitHub](https://github.com/vercel/workflow) Search... `⌘K`Ask AI\n\nAsk AI\n\nSearch... `⌘K`\n\n[Getting Started](https://useworkflow.dev/docs/getting-started)\n\n- [Next.js](https://useworkflow.dev/docs/getting-started/next)\n- [Vite](https://useworkflow.dev/docs/getting-started/vite)\n- [Astro](https://useworkflow.dev/docs/getting-started/astro)\n- [Express](https://useworkflow.dev/docs/getting-started/express)\n- [Fastify](https://useworkflow.dev/docs/getting-started/fastify)\n- [Hono](https://useworkflow.dev/docs/getting-started/hono)\n- [Nitro](https://useworkflow.dev/docs/getting-started/nitro)\n- [Nuxt](https://useworkflow.dev/docs/getting-started/nuxt)\n- [SvelteKit](https://useworkflow.dev/docs/getting-started/sveltekit)\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps)\n- [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows)\n- [Control Flow Patterns](https://useworkflow.dev/docs/foundations/control-flow-patterns)\n- [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries)\n- [Hooks & Webhooks](https://useworkflow.dev/docs/foundations/hooks)\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming)\n- [Serialization](https://useworkflow.dev/docs/foundations/serialization)\n- [Idempotency](https://useworkflow.dev/docs/foundations/idempotency)\n\nHow it works\n\n[Observability](https://useworkflow.dev/docs/observability)\n\nAI Agents\n\n- [Building Durable AI Agents](https://useworkflow.dev/docs/ai)\n- [Streaming Updates from Tools](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n- [Resumable Streams](https://useworkflow.dev/docs/ai/resumable-streams)\n- [Sleep, Suspense, and Scheduling](https://useworkflow.dev/docs/ai/sleep-and-delays)\n- [Human-in-the-Loop](https://useworkflow.dev/docs/ai/human-in-the-loop)\n- [Patterns for Defining Tools](https://useworkflow.dev/docs/ai/defining-tools)\n- [Chat Session Modeling](https://useworkflow.dev/docs/ai/chat-session-modeling)\n\n[Deploying](https://useworkflow.dev/docs/deploying)\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n[API Reference](https://useworkflow.dev/docs/api-reference)\n\nResumable StreamsImplementing stream resumption\n\nAI Agents\n\n# Resumable Streams\n\nWhen building chat interfaces, it's common to run into network interruptions, page refreshes, or serverless function timeouts, which can break the connection to an in-progress agent.\n\nWhere a standard chat implementation would require the user to resend their message and wait for the entire response again, workflow runs are durable, and so are the streams attached to them. This means a stream can be resumed at any point, optionally only syncing the data that was missed since the last connection.\n\nResumable streams come out of the box with Workflow DevKit, however, the client needs to recognize that a stream exists, and needs to know which stream to reconnect to, and needs to know where to start from. For this, Workflow DevKit provides the [`WorkflowChatTransport`](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport) helper, a drop-in transport for the AI SDK that handles client-side resumption logic for you.\n\n## [Implementing stream resumption](https://useworkflow.dev/docs/ai/resumable-streams\\#implementing-stream-resumption)\n\nLet's add stream resumption to our Flight Booking Agent that we build in the [Building Durable AI Agents](https://useworkflow.dev/docs/ai) guide.\n\n### [Return the Run ID from Your API](https://useworkflow.dev/docs/ai/resumable-streams\\#return-the-run-id-from-your-api)\n\nModify your chat endpoint to include the workflow run ID in a response header. The Run ID uniquely identifies the run's stream, so it allows the client to know which stream to reconnect to.\n\napp/api/chat/route.ts\n\n```\n\n```\n\n### [Add a Stream Reconnection Endpoint](https://useworkflow.dev/docs/ai/resumable-streams\\#add-a-stream-reconnection-endpoint)\n\nCurrently we only have one API endpoint that always creates a new run, so we need to create a new API route that returns the stream for an existing run:\n\napp/api/chat/\\[id\\]/stream/route.ts\n\n```\n\n```\n\nThe `startIndex` parameter ensures the client can choose where to resume the stream from. For instance, if the function times out during streaming, the chat transport will use `startIndex` to resume the stream exactly from the last token it received.\n\n### [Use `WorkflowChatTransport` in the Client](https://useworkflow.dev/docs/ai/resumable-streams\\#use-workflowchattransport-in-the-client)\n\nReplace the default transport in AI-SDK's `useChat` with [`WorkflowChatTransport`](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport), and update the callbacks to store and use the latest run ID. For now, we'll store the run ID in localStorage. For your own app, this would be stored wherever you store session information.\n\napp/page.tsx\n\n```\n\n```\n\nNow try the flight booking example again. Open it up in a separate tab, or spam the refresh button, and see how the client connects to the same chat stream every time.\n\n## [How It Works](https://useworkflow.dev/docs/ai/resumable-streams\\#how-it-works)\n\n1. When the user sends a message, `WorkflowChatTransport` makes a POST to `/api/chat`\n2. The API starts a workflow and returns the run ID in the `x-workflow-run-id` header\n3. `onChatSendMessage` stores this run ID in localStorage\n4. If the stream is interrupted before receiving a \"finish\" chunk, the transport automatically reconnects\n5. `prepareReconnectToStreamRequest` builds the reconnection URL using the stored run ID, pointing to the new endpoint `/api/chat/{runId}/stream`\n6. The reconnection endpoint returns the stream from where the client left off\n7. When the stream completes, `onChatEnd` clears the stored run ID\n\nThis approach also handles page refreshes, as the client will automatically reconnect to the stream from the last known position when the UI loads with a stored run ID, following the behavior of [AI SDK's stream resumption](https://ai-sdk.dev/docs/ai-sdk-ui/chatbot-resume-streams#chatbot-resume-streams).\n\n## [Related Documentation](https://useworkflow.dev/docs/ai/resumable-streams\\#related-documentation)\n\n- [`WorkflowChatTransport` API Reference](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport) \\- Full configuration options\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming) \\- Understanding workflow streams\n- [`getRun()` API Reference](https://useworkflow.dev/docs/api-reference/workflow-api/get-run) \\- Retrieving existing runs\n\n[Streaming Updates from Tools\\\\\n\\\\\nPrevious Page](https://useworkflow.dev/docs/ai/streaming-updates-from-tools) [Sleep, Suspense, and Scheduling\\\\\n\\\\\nNext Page](https://useworkflow.dev/docs/ai/sleep-and-delays)\n\nOn this page\n\n[Implementing stream resumption](https://useworkflow.dev/docs/ai/resumable-streams#implementing-stream-resumption) [Return the Run ID from Your API](https://useworkflow.dev/docs/ai/resumable-streams#return-the-run-id-from-your-api) [Add a Stream Reconnection Endpoint](https://useworkflow.dev/docs/ai/resumable-streams#add-a-stream-reconnection-endpoint) [Use `WorkflowChatTransport` in the Client](https://useworkflow.dev/docs/ai/resumable-streams#use-workflowchattransport-in-the-client) [How It Works](https://useworkflow.dev/docs/ai/resumable-streams#how-it-works) [Related Documentation](https://useworkflow.dev/docs/ai/resumable-streams#related-documentation)\n\n[GitHubEdit this page on GitHub](https://github.com/vercel/workflow/edit/main/content/docs/ai/resumable-streams.mdx) Scroll to topGive feedbackCopy pageAsk AI about this pageOpen in chat\n\n## Chat\n\nWhat is Workflow?How does retrying work?What control flow patterns are there?How do directives work?How do I build an AI agent?\n\nTip: You can open and close chat with `⌘I`\n\n0 / 1000",
  "metadata": {
    "ogTitle": "Resumable Streams",
    "og:title": "Resumable Streams",
    "og:image:type": "image/png",
    "twitter:image:height": "628",
    "og:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "twitter:title": "Resumable Streams",
    "twitter:card": "summary_large_image",
    "og:image:width": "1200",
    "viewport": "width=device-width, initial-scale=1",
    "twitter:image:type": "image/png",
    "ogImage": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "twitter:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "twitter:image:width": "1200",
    "next-size-adjust": "",
    "language": "en",
    "og:image:height": "628",
    "title": "Resumable Streams",
    "favicon": "https://useworkflow.dev/favicon.ico?favicon.e7ce0d1c.ico",
    "scrapeId": "019bf2d4-569c-75d7-940f-02de503053f3",
    "sourceURL": "https://useworkflow.dev/docs/ai/resumable-streams",
    "url": "https://useworkflow.dev/docs/ai/resumable-streams",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "proxyUsed": "basic",
    "cacheState": "hit",
    "cachedAt": "2026-01-24T22:00:45.107Z",
    "creditsUsed": 1
  }
}