{
  "markdown": "[Vercel](https://vercel.com/) Slash [Workflow DevKit LogoWorkflow](https://useworkflow.dev/)\n\n- [Docs](https://useworkflow.dev/docs)\n- [Examples](https://github.com/vercel/workflow-examples)\n\n[X](https://x.com/workflowdevkit) [GitHub](https://github.com/vercel/workflow) Search... `⌘K`Ask AI\n\nAsk AI\n\nSearch... `⌘K`\n\n[Getting Started](https://useworkflow.dev/docs/getting-started)\n\n- [Next.js](https://useworkflow.dev/docs/getting-started/next)\n- [Vite](https://useworkflow.dev/docs/getting-started/vite)\n- [Astro](https://useworkflow.dev/docs/getting-started/astro)\n- [Express](https://useworkflow.dev/docs/getting-started/express)\n- [Fastify](https://useworkflow.dev/docs/getting-started/fastify)\n- [Hono](https://useworkflow.dev/docs/getting-started/hono)\n- [Nitro](https://useworkflow.dev/docs/getting-started/nitro)\n- [Nuxt](https://useworkflow.dev/docs/getting-started/nuxt)\n- [SvelteKit](https://useworkflow.dev/docs/getting-started/sveltekit)\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps)\n- [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows)\n- [Control Flow Patterns](https://useworkflow.dev/docs/foundations/control-flow-patterns)\n- [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries)\n- [Hooks & Webhooks](https://useworkflow.dev/docs/foundations/hooks)\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming)\n- [Serialization](https://useworkflow.dev/docs/foundations/serialization)\n- [Idempotency](https://useworkflow.dev/docs/foundations/idempotency)\n\nHow it works\n\n[Observability](https://useworkflow.dev/docs/observability)\n\nAI Agents\n\n- [Building Durable AI Agents](https://useworkflow.dev/docs/ai)\n- [Streaming Updates from Tools](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n- [Resumable Streams](https://useworkflow.dev/docs/ai/resumable-streams)\n- [Sleep, Suspense, and Scheduling](https://useworkflow.dev/docs/ai/sleep-and-delays)\n- [Human-in-the-Loop](https://useworkflow.dev/docs/ai/human-in-the-loop)\n- [Patterns for Defining Tools](https://useworkflow.dev/docs/ai/defining-tools)\n- [Chat Session Modeling](https://useworkflow.dev/docs/ai/chat-session-modeling)\n\n[Deploying](https://useworkflow.dev/docs/deploying)\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n[API Reference](https://useworkflow.dev/docs/api-reference)\n\nWorkflowChatTransportAPI Signature\n\n[API Reference](https://useworkflow.dev/docs/api-reference) [@workflow/ai](https://useworkflow.dev/docs/api-reference/workflow-ai)\n\n# WorkflowChatTransport\n\nThe `@workflow/ai` package is currently in active development and should be considered experimental.\n\nA chat transport implementation for the AI SDK that provides reliable message streaming with automatic reconnection to interrupted streams. This transport is a drop-in replacement for the default AI SDK transport, enabling seamless recovery from network issues, page refreshes, or Vercel Function timeouts.\n\n`WorkflowChatTransport` implements the [`ChatTransport`](https://ai-sdk.dev/docs/ai-sdk-ui/transport) interface from the AI SDK and is designed to work with workflow-based chat applications. It requires endpoints that return the `x-workflow-run-id` header to enable stream resumption.\n\n```\nimport { useChat } from \"@ai-sdk/react\";\nimport { WorkflowChatTransport } from \"@workflow/ai\";\n\nexport default function Chat() {\n  const { messages, sendMessage } = useChat({\n    transport: new WorkflowChatTransport(),\n  });\n\n  return (\n    <div>\n      {messages.map((m) => (\n        <div key={m.id}>{m.content}</div>\n      ))}\n    </div>\n  );\n}\n```\n\n## [API Signature](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#api-signature)\n\n### [Class](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#class)\n\n| Name | Type | Description |\n| --- | --- | --- |\n| `api` | any |  |\n| `fetch` | any |  |\n| `onChatSendMessage` | any |  |\n| `onChatEnd` | any |  |\n| `maxConsecutiveErrors` | any |  |\n| `prepareSendMessagesRequest` | any |  |\n| `prepareReconnectToStreamRequest` | any |  |\n| `sendMessages` | (options: SendMessagesOptions<UI\\_MESSAGE> & ChatRequestOptions) => Promise<ReadableStream<UIMessageChunk>> | Sends messages to the chat endpoint and returns a stream of response chunks.<br>This method handles the entire chat lifecycle including:<br>\\- Sending messages to the /api/chat endpoint<br>\\- Streaming response chunks<br>\\- Automatic reconnection if the stream is interrupted |\n| `sendMessagesIterator` | any |  |\n| `reconnectToStream` | (options: ReconnectToStreamOptions & ChatRequestOptions) => Promise<ReadableStream<UIMessageChunk> \\| null> | Reconnects to an existing chat stream that was previously interrupted.<br>This method is useful for resuming a chat session after network issues,<br>page refreshes, or Vercel Function timeouts. |\n| `reconnectToStreamIterator` | any |  |\n| `onFinish` | any |  |\n\n### [WorkflowChatTransportOptions](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#workflowchattransportoptions)\n\n| Name | Type | Description |\n| --- | --- | --- |\n| `api` | string | API endpoint for chat requests<br>Defaults to /api/chat if not provided |\n| `fetch` | { (input: RequestInfo \\| URL, init?: RequestInit \\| undefined): Promise<Response>; (input: string \\| Request \\| URL, init?: RequestInit \\| undefined): Promise<...>; } | Custom fetch implementation to use for HTTP requests.<br>Defaults to the global fetch function if not provided. |\n| `onChatSendMessage` | OnChatSendMessage<UI\\_MESSAGE> | Callback invoked after successfully sending messages to the chat endpoint.<br>Useful for tracking chat history and inspecting response headers. |\n| `onChatEnd` | OnChatEnd | Callback invoked when a chat stream ends (receives a \"finish\" chunk).<br>Useful for cleanup operations or state updates. |\n| `maxConsecutiveErrors` | number | Maximum number of consecutive errors allowed during reconnection attempts.<br>Defaults to 3 if not provided. |\n| `prepareSendMessagesRequest` | PrepareSendMessagesRequest<UI\\_MESSAGE> | Function to prepare the request for sending messages.<br>Allows customizing the API endpoint, headers, credentials, and body. |\n| `prepareReconnectToStreamRequest` | PrepareReconnectToStreamRequest | Function to prepare the request for reconnecting to a stream.<br>Allows customizing the API endpoint, headers, and credentials. |\n\n## [Key Features](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#key-features)\n\n- **Automatic Reconnection**: Automatically recovers from interrupted streams with configurable retry limits\n- **Workflow Integration**: Seamlessly works with workflow-based endpoints that provide the `x-workflow-run-id` header\n- **Customizable Requests**: Allows intercepting and modifying requests via `prepareSendMessagesRequest` and `prepareReconnectToStreamRequest`\n- **Stream Callbacks**: Provides hooks for tracking chat lifecycle via `onChatSendMessage` and `onChatEnd`\n- **Custom Fetch**: Supports custom fetch implementations for advanced use cases\n\n## [Good to Know](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#good-to-know)\n\n- The transport expects chat endpoints to return the `x-workflow-run-id` header in the response to enable stream resumption\n- By default, the transport posts to `/api/chat` and reconnects via `/api/chat/{runId}/stream`\n- The `onChatSendMessage` callback receives the full response object, allowing you to extract and store the workflow run ID for session resumption\n- Stream interruptions are automatically detected when a \"finish\" chunk is not received in the initial response\n- The `maxConsecutiveErrors` option controls how many reconnection attempts are made before giving up (default: 3)\n\n## [Examples](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#examples)\n\n### [Basic Chat Setup](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#basic-chat-setup)\n\n```\n\"use client\";\n\nimport { useChat } from \"@ai-sdk/react\";\nimport { WorkflowChatTransport } from \"@workflow/ai\";\nimport { useState } from \"react\";\n\nexport default function BasicChat() {\n  const [input, setInput] = useState(\"\");\n  const { messages, sendMessage } = useChat({\n    transport: new WorkflowChatTransport(),\n  });\n\n  return (\n    <div>\n      <div className=\"space-y-4\">\n        {messages.map((m) => (\n          <div key={m.id}>\n            <strong>{m.role}:</strong> {m.content}\n          </div>\n        ))}\n      </div>\n\n      <form\n        onSubmit={(e) => {\n          e.preventDefault();\n          sendMessage({ text: input });\n          setInput(\"\");\n        }}\n      >\n        <input\n          value={input}\n          placeholder=\"Say something...\"\n          onChange={(e) => setInput(e.currentTarget.value)}\n        />\n      </form>\n    </div>\n  );\n}\n```\n\n### [With Session Persistence and Resumption](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#with-session-persistence-and-resumption)\n\n```\n\"use client\";\n\nimport { useChat } from \"@ai-sdk/react\";\nimport { WorkflowChatTransport } from \"@workflow/ai\";\nimport { useMemo, useState } from \"react\";\n\nexport default function ChatWithResumption() {\n  const [input, setInput] = useState(\"\");\n  const activeWorkflowRunId = useMemo(() => {\n    if (typeof window === \"undefined\") return;\n    return localStorage.getItem(\"active-workflow-run-id\") ?? undefined;\n  }, []);\n\n  const { messages, sendMessage } = useChat({\n    resume: !!activeWorkflowRunId,\n    transport: new WorkflowChatTransport({\n      onChatSendMessage: (response, options) => {\n        // Save chat history to localStorage\n        localStorage.setItem(\n          \"chat-history\",\n          JSON.stringify(options.messages)\n        );\n\n        // Extract and store the workflow run ID for session resumption\n        const workflowRunId = response.headers.get(\"x-workflow-run-id\");\n        if (workflowRunId) {\n          localStorage.setItem(\"active-workflow-run-id\", workflowRunId);\n        }\n      },\n      onChatEnd: ({ chatId, chunkIndex }) => {\n        console.log(`Chat ${chatId} completed with ${chunkIndex} chunks`);\n        // Clear the active run ID when chat completes\n        localStorage.removeItem(\"active-workflow-run-id\");\n      },\n    }),\n  });\n\n  return (\n    <div>\n      <div className=\"space-y-4\">\n        {messages.map((m) => (\n          <div key={m.id}>\n            <strong>{m.role}:</strong> {m.content}\n          </div>\n        ))}\n      </div>\n\n      <form\n        onSubmit={(e) => {\n          e.preventDefault();\n          sendMessage({ text: input });\n          setInput(\"\");\n        }}\n      >\n        <input\n          value={input}\n          placeholder=\"Say something...\"\n          onChange={(e) => setInput(e.currentTarget.value)}\n        />\n      </form>\n    </div>\n  );\n}\n```\n\n### [With Custom Request Configuration](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#with-custom-request-configuration)\n\n```\n\"use client\";\n\nimport { useChat } from \"@ai-sdk/react\";\nimport { WorkflowChatTransport } from \"@workflow/ai\";\nimport { useState } from \"react\";\n\nexport default function ChatWithCustomConfig() {\n  const [input, setInput] = useState(\"\");\n  const { messages, sendMessage } = useChat({\n    transport: new WorkflowChatTransport({\n      prepareSendMessagesRequest: async (config) => {\n        return {\n          ...config,\n          api: \"/api/chat\",\n          headers: {\n            ...config.headers,\n            \"Authorization\": `Bearer ${process.env.NEXT_PUBLIC_API_TOKEN}`,\n            \"X-Custom-Header\": \"custom-value\",\n          },\n          credentials: \"include\",\n        };\n      },\n      prepareReconnectToStreamRequest: async (config) => {\n        return {\n          ...config,\n          headers: {\n            ...config.headers,\n            \"Authorization\": `Bearer ${process.env.NEXT_PUBLIC_API_TOKEN}`,\n          },\n          credentials: \"include\",\n        };\n      },\n      maxConsecutiveErrors: 5,\n    }),\n  });\n\n  return (\n    <div>\n      <div className=\"space-y-4\">\n        {messages.map((m) => (\n          <div key={m.id}>\n            <strong>{m.role}:</strong> {m.content}\n          </div>\n        ))}\n      </div>\n\n      <form\n        onSubmit={(e) => {\n          e.preventDefault();\n          sendMessage({ text: input });\n          setInput(\"\");\n        }}\n      >\n        <input\n          value={input}\n          placeholder=\"Say something...\"\n          onChange={(e) => setInput(e.currentTarget.value)}\n        />\n      </form>\n    </div>\n  );\n}\n```\n\n## [See Also](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport\\#see-also)\n\n- [DurableAgent](https://useworkflow.dev/docs/api-reference/workflow-ai/durable-agent) \\- Building durable AI agents within workflows\n- [AI SDK `useChat` Documentation](https://ai-sdk.dev/docs/reference/ai-sdk-ui/use-chat) \\- Using `useChat` with custom transports\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps) \\- Understanding workflow fundamentals\n- [\"flight-booking-app\" Example](https://github.com/vercel/workflow-examples/tree/main/flight-booking-app) \\- An example application which uses `WorkflowChatTransport`\n\n[DurableAgent\\\\\n\\\\\nPrevious Page](https://useworkflow.dev/docs/api-reference/workflow-ai/durable-agent)\n\nOn this page\n\n[API Signature](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#api-signature) [Class](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#class) [WorkflowChatTransportOptions](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#workflowchattransportoptions) [Key Features](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#key-features) [Good to Know](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#good-to-know) [Examples](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#examples) [Basic Chat Setup](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#basic-chat-setup) [With Session Persistence and Resumption](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#with-session-persistence-and-resumption) [With Custom Request Configuration](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#with-custom-request-configuration) [See Also](https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport#see-also)\n\n[GitHubEdit this page on GitHub](https://github.com/vercel/workflow/edit/main/content/docs/api-reference/workflow-ai/workflow-chat-transport.mdx) Scroll to topGive feedbackCopy pageAsk AI about this pageOpen in chat\n\n## Chat\n\nWhat is Workflow?How does retrying work?What control flow patterns are there?How do directives work?How do I build an AI agent?\n\nTip: You can open and close chat with `⌘I`\n\n0 / 1000",
  "metadata": {
    "viewport": "width=device-width, initial-scale=1",
    "twitter:image:type": "image/png",
    "ogTitle": "WorkflowChatTransport",
    "language": "en",
    "twitter:image:height": "628",
    "og:image:width": "1200",
    "title": "WorkflowChatTransport",
    "twitter:title": "WorkflowChatTransport",
    "next-size-adjust": "",
    "twitter:card": "summary_large_image",
    "ogImage": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "og:title": "WorkflowChatTransport",
    "og:image:height": "628",
    "twitter:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "og:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "og:image:type": "image/png",
    "twitter:image:width": "1200",
    "favicon": "https://useworkflow.dev/favicon.ico?favicon.e7ce0d1c.ico",
    "scrapeId": "019bf2d4-569c-75d7-940f-29590d5431be",
    "sourceURL": "https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport",
    "url": "https://useworkflow.dev/docs/api-reference/workflow-ai/workflow-chat-transport",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "proxyUsed": "basic",
    "cacheState": "hit",
    "cachedAt": "2026-01-24T22:00:38.706Z",
    "creditsUsed": 1
  }
}