{
  "markdown": "[Vercel](https://vercel.com/) Slash [Workflow DevKit LogoWorkflow](https://useworkflow.dev/)\n\n- [Docs](https://useworkflow.dev/docs)\n- [Examples](https://github.com/vercel/workflow-examples)\n\n[X](https://x.com/workflowdevkit) [GitHub](https://github.com/vercel/workflow) Search... `⌘K`Ask AI\n\nAsk AI\n\nSearch... `⌘K`\n\n[Getting Started](https://useworkflow.dev/docs/getting-started)\n\n- [Next.js](https://useworkflow.dev/docs/getting-started/next)\n- [Vite](https://useworkflow.dev/docs/getting-started/vite)\n- [Astro](https://useworkflow.dev/docs/getting-started/astro)\n- [Express](https://useworkflow.dev/docs/getting-started/express)\n- [Fastify](https://useworkflow.dev/docs/getting-started/fastify)\n- [Hono](https://useworkflow.dev/docs/getting-started/hono)\n- [Nitro](https://useworkflow.dev/docs/getting-started/nitro)\n- [Nuxt](https://useworkflow.dev/docs/getting-started/nuxt)\n- [SvelteKit](https://useworkflow.dev/docs/getting-started/sveltekit)\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps)\n- [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows)\n- [Control Flow Patterns](https://useworkflow.dev/docs/foundations/control-flow-patterns)\n- [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries)\n- [Hooks & Webhooks](https://useworkflow.dev/docs/foundations/hooks)\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming)\n- [Serialization](https://useworkflow.dev/docs/foundations/serialization)\n- [Idempotency](https://useworkflow.dev/docs/foundations/idempotency)\n\nHow it works\n\n[Observability](https://useworkflow.dev/docs/observability)\n\nAI Agents\n\n- [Building Durable AI Agents](https://useworkflow.dev/docs/ai)\n- [Streaming Updates from Tools](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n- [Resumable Streams](https://useworkflow.dev/docs/ai/resumable-streams)\n- [Sleep, Suspense, and Scheduling](https://useworkflow.dev/docs/ai/sleep-and-delays)\n- [Human-in-the-Loop](https://useworkflow.dev/docs/ai/human-in-the-loop)\n- [Patterns for Defining Tools](https://useworkflow.dev/docs/ai/defining-tools)\n- [Chat Session Modeling](https://useworkflow.dev/docs/ai/chat-session-modeling)\n\n[Deploying](https://useworkflow.dev/docs/deploying)\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n[API Reference](https://useworkflow.dev/docs/api-reference)\n\nBuilding Durable AI AgentsWhy Durable Agents?\n\nAI Agents\n\n# Building Durable AI Agents\n\nAI agents are built on the primitive of LLM and tool-call loops, often with additional processes for data fetching, resource provisioning, or reacting to external events.\n\nWorkflow DevKit makes your agents production-ready, by turning them into durable, resumable workflows. It transforms your LLM calls, tool executions, and other async operations into retryable, scalable, and observable steps.\n\nchatWorkflow100ms\n\nagent.stream\n\nsearchWeb\n\nagent.stream\n\nwaitForHumanApproval\n\nagent.stream\n\nThis guide walks you through converting a basic AI chat app into a durable AI agent using Workflow DevKit.\n\n## [Why Durable Agents?](https://useworkflow.dev/docs/ai\\#why-durable-agents)\n\nAside from the usual challenges of getting your long-running tasks to be production-ready, building mature AI agents typically requires solving several **additional challenges**:\n\n- **Statefulness**: Persisting chat sessions and turning LLM and tool calls into async jobs with workers and queues.\n- **Observability**: Using services to collect traces and metrics, and managing them separately from your messages and user history.\n- **Resumability**: Resuming streams requires not just storing your messages, but also storing streams, and piping them across services.\n- **Human-in-the-loop**: Your client, API, and async job orchestration need to work together to create, track, route to, and display human approval requests, or similar webhook operations.\n\nWorkflow DevKit provides all of these capabilities out of the box. Your agent becomes a workflow, your tools become steps, and the framework handles interplay with your existing infrastructure.\n\n## [Getting Started](https://useworkflow.dev/docs/ai\\#getting-started)\n\nTo make an Agent durable, we first need an Agent, which we'll be setting up here. If you already have an app you'd like to follow along with, you can skip this section.\n\nFor our example, we'll need an app with a simple chat interface and an API route calling an LLM, so that we can add Workflow DevKit to it. We'll use the [Flight Booking Agent](https://github.com/vercel/workflow-examples/tree/main/flight-booking-app) example as a starting point, which comes with a chat interface built using Next.js, AI SDK, and Shadcn UI.\n\n### [Clone example app](https://useworkflow.dev/docs/ai\\#clone-example-app)\n\nWe'll need an app with a simple chat interface and an API route calling an LLM, so that we can add Workflow DevKit to it. For the follow-along steps, we'll use the [Flight Booking Agent](https://github.com/vercel/workflow-examples/tree/main/flight-booking-app) example as a starting point, which comes with a chat interface built using Next.js, AI SDK, and Shadcn UI.\n\nIf you have your own project, you can skip this step, and simply apply the changes of the following steps to your own project.\n\n```\ngit clone https://github.com/vercel/workflow-examples -b plain-ai-sdk\ncd workflow-examples/flight-booking-app\n```\n\n### [Set up API keys](https://useworkflow.dev/docs/ai\\#set-up-api-keys)\n\nIn order to connect to an LLM, we'll need to set up an API key. The easiest way to do this is to use Vercel Gateway (works with all providers at zero markup), or you can configure a custom provider.\n\nGatewayCustom Provider\n\nGet a Gateway API key from the [Vercel Gateway](https://vercel.com/docs/gateway/api-reference/overview) page.\n\nThen add it to your `.env.local` file:\n\n.env.local\n\n```\n\n```\n\nThis is an example of how to use the OpenAI provider for AI SDK. For details on other providers and more details, see the [AI SDK provider guide](https://ai-sdk.dev/providers/ai-sdk-providers).\n\nnpm\n\npnpm\n\nyarn\n\nbun\n\n```\nnpm i @ai-sdk/openai\n```\n\nSet your OpenAI API key in your environment variables:\n\n.env.local\n\n```\n\n```\n\nThen modify your API endpoint to use the OpenAI provider:\n\napp/api/chat/route.ts\n\n```\n\n```\n\n### [Get familiar with the code](https://useworkflow.dev/docs/ai\\#get-familiar-with-the-code)\n\nLet's take a moment to see what we're working with. Run the app with `npm run dev` and open [http://localhost:3000](http://localhost:3000/) in your browser. You should see a simple chat interface to play with. Go ahead and give it a try.\n\nThe core code that makes all of this happen is quite simple. Here's a breakdown of the main parts. Note that there's no changes needed here, we're simply taking a look at the code to understand what's happening.\n\nAPI RouteToolsClient\n\nOur API route makes a simple call to [AI SDK's `Agent` class](https://ai-sdk.dev/docs/agents/overview), which is a simple wrapper around [AI SDK's `streamText` function](https://ai-sdk.dev/docs/reference/ai-sdk-core/stream-text#streamtext). This is also where we pass tools to the agent.\n\napp/api/chat/route.ts\n\n```\n\n```\n\nOur tools are mostly mocked out for the sake of the example. We use AI SDK's `tool` function to define the tool, and pass it to the agent. In your own app, this might be any kind of tool call, like database queries, calls to external services, etc.\n\nworkflows/chat/steps/tools.ts\n\n```\n\n```\n\nOur `ChatPage` component has a lot of logic for nicely displaying the chat messages, but at it's core, it's simply managing input/output for the [`useChat` hook](https://ai-sdk.dev/docs/reference/ai-sdk-ui/use-chat#usechat) from AI SDK.\n\napp/chat.tsx\n\n```\n\n```\n\n## [Integrating Workflow DevKit](https://useworkflow.dev/docs/ai\\#integrating-workflow-devkit)\n\nNow that we have a basic agent using AI SDK, we can modify it to make it durable.\n\n### [Install Dependencies](https://useworkflow.dev/docs/ai\\#install-dependencies)\n\nAdd the Workflow DevKit packages to your project:\n\nnpm\n\npnpm\n\nyarn\n\nbun\n\n```\nnpm i workflow @workflow/ai\n```\n\nand extend the Next.js config to transform your workflow code (see [Getting Started](https://useworkflow.dev/docs/getting-started/next) for more details).\n\nnext.config.ts\n\n```\n\n```\n\n### [Create a Workflow Function](https://useworkflow.dev/docs/ai\\#create-a-workflow-function)\n\nMove the agent logic into a separate function, which will serve as our workflow definition.\n\nworkflows/chat/workflow.ts\n\n```\n\n```\n\nKey changes:\n\n- Add the `\"use workflow\"` directive to mark our Agent as a workflow function\n- Replaced `Agent` with [`DurableAgent`](https://useworkflow.dev/docs/api-reference/workflow-ai/durable-agent) from `@workflow/ai/agent`. This ensures that all calls to the LLM are executed as \"steps\", and results are aggregated within the workflow context (see [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps) for more details on how workflows/steps are defined).\n- Use [`getWritable()`](https://useworkflow.dev/docs/api-reference/workflow/get-writable) to get a stream for agent output. This stream is persistent, and API endpoints can read from a run's stream at any time.\n\n### [Update the API Route](https://useworkflow.dev/docs/ai\\#update-the-api-route)\n\nRemove the agent call that we just extracted, and replace it with a call to `start()` to run the workflow:\n\napp/api/chat/route.ts\n\n```\n\n```\n\nKey changes:\n\n- Call `start()` to run the workflow function. This returns a `Run` object, which contains the run ID and the readable stream (see [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows) for more details on the `Run` object).\n- Pass the `writable` to `agent.stream()` instead of returning a stream directly, ensuring all the Agent output is written to to the run's stream.\n\n### [Convert Tools to Steps](https://useworkflow.dev/docs/ai\\#convert-tools-to-steps)\n\nMark all tool definitions with `\"use step\"` to make them durable. This enables automatic retries and observability for each tool call:\n\nworkflows/chat/steps/tools.ts​\n\n```\n\n```\n\nWith `\"use step\"`:\n\n- The tool execution runs in a separate step with full Node.js access. In production, each step is executed in a separate worker process, which scales automatically with your workload.\n- Failed tool calls are automatically retried (up to 3 times by default). See [Errors and Retries](https://useworkflow.dev/docs/foundations/errors-and-retries) for more details.\n- Each tool execution appears as a discrete step in observability tools. See [Observability](https://useworkflow.dev/docs/observability) for more details.\n\nThat's all you need to do to convert your basic AI SDK agent into a durable agent. If you run your development server, and send a chat message, you should see your agent respond just as before, but now with added durability and observability.\n\n## [Observability](https://useworkflow.dev/docs/ai\\#observability)\n\nIn your app directory, you can open up the observability dashboard to see your workflow in action, using the CLI:\n\n```\nnpx workflow web\n```\n\nThis opens a local dashboard showing all workflow runs and their status, as well as a trace viewer to inspect the workflow in detail, including retry attempts, and the data being passed between steps.\n\n## [Next Steps](https://useworkflow.dev/docs/ai\\#next-steps)\n\nNow that you have a basic durable agent, it's a only a short step to add these additional features:\n\n[**Streaming Updates from Tools** \\\\\n\\\\\nStream progress updates from tools to the UI while they're executing.](https://useworkflow.dev/docs/ai/streaming-updates-from-tools) [**Resumable Streams** \\\\\n\\\\\nEnable clients to reconnect to interrupted streams without losing data.](https://useworkflow.dev/docs/ai/resumable-streams) [**Sleep, Suspense, and Scheduling** \\\\\n\\\\\nAdd native sleep, suspense, and scheduling functionality to your Agent and workflow.](https://useworkflow.dev/docs/ai/sleep-and-delays) [**Human-in-the-Loop** \\\\\n\\\\\nImplement approval steps to wait for human input or external events.](https://useworkflow.dev/docs/ai/human-in-the-loop)\n\n## [Complete Example](https://useworkflow.dev/docs/ai\\#complete-example)\n\nA complete example that includes all of the above, plus all of the \"next steps\" features is available on the main branch of the [Flight Booking Agent](https://github.com/vercel/workflow-examples/tree/main/flight-booking-app) example.\n\n## [Related Documentation](https://useworkflow.dev/docs/ai\\#related-documentation)\n\n- [Tools](https://useworkflow.dev/docs/ai/defining-tools) \\- Patterns for defining tools for your agent\n- [`DurableAgent` API Reference](https://useworkflow.dev/docs/api-reference/workflow-ai/durable-agent) \\- Full API documentation\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps) \\- Core concepts\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming) \\- In-depth streaming guide\n- [Errors and Retries](https://useworkflow.dev/docs/foundations/errors-and-retries) \\- Error handling patterns\n\n[Observability\\\\\n\\\\\nPrevious Page](https://useworkflow.dev/docs/observability) [Streaming Updates from Tools\\\\\n\\\\\nNext Page](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n\nOn this page\n\n[Why Durable Agents?](https://useworkflow.dev/docs/ai#why-durable-agents) [Getting Started](https://useworkflow.dev/docs/ai#getting-started) [Clone example app](https://useworkflow.dev/docs/ai#clone-example-app) [Set up API keys](https://useworkflow.dev/docs/ai#set-up-api-keys) [Get familiar with the code](https://useworkflow.dev/docs/ai#get-familiar-with-the-code) [Integrating Workflow DevKit](https://useworkflow.dev/docs/ai#integrating-workflow-devkit) [Install Dependencies](https://useworkflow.dev/docs/ai#install-dependencies) [Create a Workflow Function](https://useworkflow.dev/docs/ai#create-a-workflow-function) [Update the API Route](https://useworkflow.dev/docs/ai#update-the-api-route) [Convert Tools to Steps](https://useworkflow.dev/docs/ai#convert-tools-to-steps) [Observability](https://useworkflow.dev/docs/ai#observability) [Next Steps](https://useworkflow.dev/docs/ai#next-steps) [Complete Example](https://useworkflow.dev/docs/ai#complete-example) [Related Documentation](https://useworkflow.dev/docs/ai#related-documentation)\n\n[GitHubEdit this page on GitHub](https://github.com/vercel/workflow/edit/main/content/docs/ai/index.mdx) Scroll to topGive feedbackCopy pageAsk AI about this pageOpen in chat\n\n## Chat\n\nWhat is Workflow?How does retrying work?What control flow patterns are there?How do directives work?How do I build an AI agent?\n\nTip: You can open and close chat with `⌘I`\n\n0 / 1000",
  "metadata": {
    "twitter:image:type": "image/png",
    "og:image:type": "image/png",
    "og:title": "Building Durable AI Agents",
    "twitter:image:width": "1200",
    "twitter:card": "summary_large_image",
    "next-size-adjust": "",
    "og:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "ogTitle": "Building Durable AI Agents",
    "ogImage": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "og:image:height": "628",
    "language": "en",
    "title": "Building Durable AI Agents",
    "twitter:image:height": "628",
    "viewport": "width=device-width, initial-scale=1",
    "og:image:width": "1200",
    "twitter:title": "Building Durable AI Agents",
    "twitter:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "favicon": "https://useworkflow.dev/favicon.ico?favicon.e7ce0d1c.ico",
    "scrapeId": "019bf2d4-569c-75d7-940f-6c87a063f811",
    "sourceURL": "https://useworkflow.dev/docs/ai",
    "url": "https://useworkflow.dev/docs/ai",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "proxyUsed": "basic",
    "cacheState": "hit",
    "cachedAt": "2026-01-24T22:01:38.618Z",
    "creditsUsed": 1
  }
}