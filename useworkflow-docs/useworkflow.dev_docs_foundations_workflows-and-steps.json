{
  "markdown": "[Vercel](https://vercel.com/) Slash [Workflow DevKit LogoWorkflow](https://useworkflow.dev/)\n\n- [Docs](https://useworkflow.dev/docs)\n- [Examples](https://github.com/vercel/workflow-examples)\n\n[X](https://x.com/workflowdevkit) [GitHub](https://github.com/vercel/workflow) Search... `⌘K`Ask AI\n\nAsk AI\n\nSearch... `⌘K`\n\n[Getting Started](https://useworkflow.dev/docs/getting-started)\n\n- [Next.js](https://useworkflow.dev/docs/getting-started/next)\n- [Vite](https://useworkflow.dev/docs/getting-started/vite)\n- [Astro](https://useworkflow.dev/docs/getting-started/astro)\n- [Express](https://useworkflow.dev/docs/getting-started/express)\n- [Fastify](https://useworkflow.dev/docs/getting-started/fastify)\n- [Hono](https://useworkflow.dev/docs/getting-started/hono)\n- [Nitro](https://useworkflow.dev/docs/getting-started/nitro)\n- [Nuxt](https://useworkflow.dev/docs/getting-started/nuxt)\n- [SvelteKit](https://useworkflow.dev/docs/getting-started/sveltekit)\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps)\n- [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows)\n- [Control Flow Patterns](https://useworkflow.dev/docs/foundations/control-flow-patterns)\n- [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries)\n- [Hooks & Webhooks](https://useworkflow.dev/docs/foundations/hooks)\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming)\n- [Serialization](https://useworkflow.dev/docs/foundations/serialization)\n- [Idempotency](https://useworkflow.dev/docs/foundations/idempotency)\n\nHow it works\n\n[Observability](https://useworkflow.dev/docs/observability)\n\nAI Agents\n\n- [Building Durable AI Agents](https://useworkflow.dev/docs/ai)\n- [Streaming Updates from Tools](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n- [Resumable Streams](https://useworkflow.dev/docs/ai/resumable-streams)\n- [Sleep, Suspense, and Scheduling](https://useworkflow.dev/docs/ai/sleep-and-delays)\n- [Human-in-the-Loop](https://useworkflow.dev/docs/ai/human-in-the-loop)\n- [Patterns for Defining Tools](https://useworkflow.dev/docs/ai/defining-tools)\n- [Chat Session Modeling](https://useworkflow.dev/docs/ai/chat-session-modeling)\n\n[Deploying](https://useworkflow.dev/docs/deploying)\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n[API Reference](https://useworkflow.dev/docs/api-reference)\n\nWorkflows and StepsWorkflow Functions\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n# Workflows and Steps\n\nWorkflows (a.k.a. _durable functions_) are a programming model for building long-running, stateful application logic that can maintain its execution state across restarts, failures, or user events. Unlike traditional serverless functions that lose all state when they terminate, workflows persist their progress and can resume exactly where they left off.\n\nMoreover, workflows let you easily model complex multi-step processes in simple, elegant code. To do this, we introduce two fundamental entities:\n\n1. **Workflow Functions**: Functions that orchestrate/organize steps\n2. **Step Functions**: Functions that carry out the actual work\n\n## [Workflow Functions](https://useworkflow.dev/docs/foundations/workflows-and-steps\\#workflow-functions)\n\n_Directive: `\"use workflow\"`_\n\nWorkflow functions define the entrypoint of a workflow and organize how step functions are called. This type of function does not have access to the Node.js runtime, and usable `npm` packages are limited.\n\nAlthough this may seem limiting initially, this feature is important in order to suspend and accurately resume execution of workflows.\n\nIt helps to think of the workflow function less like a full JavaScript runtime and more like \"stitching together\" various steps using conditionals, loops, try/catch handlers, `Promise.all`, and other language primitives.\n\n```\nexport async function processOrderWorkflow(orderId: string) {\n  \"use workflow\";\n\n  // Orchestrate multiple steps\n  const order = await fetchOrder(orderId);\n  const payment = await chargePayment(order);\n\n  return { orderId, status: \"completed\" };\n}\n```\n\n**Key Characteristics:**\n\n- Runs in a sandboxed environment without full Node.js access\n- All step results are persisted to the [event log](https://useworkflow.dev/docs/how-it-works/event-sourcing)\n- Must be **deterministic** to allow resuming after failures\n\nDeterminism in the workflow is required to resume the workflow from a suspension. Essentially, the workflow code gets re-run multiple times during its lifecycle, each time using the [event log](https://useworkflow.dev/docs/how-it-works/event-sourcing) to resume the workflow to the correct spot.\n\nThe sandboxed environment that workflows run in already ensures determinism. For instance, `Math.random` and `Date` constructors are fixed in workflow runs, so you are safe to use them, and the framework ensures that the values don't change across replays.\n\n## [Step Functions](https://useworkflow.dev/docs/foundations/workflows-and-steps\\#step-functions)\n\n_Directive: `\"use step\"`_\n\nStep functions perform the actual work in a workflow and have full runtime access.\n\n```\nasync function chargePayment(order: Order) {\n  \"use step\";\n\n  // Full Node.js access - use any npm package\n  const stripe = new Stripe(process.env.STRIPE_KEY);\n\n  const charge = await stripe.charges.create({\n    amount: order.total,\n    currency: \"usd\",\n    source: order.paymentToken\n  });\n\n  return { chargeId: charge.id };\n}\n```\n\n**Key Characteristics:**\n\n- Full Node.js runtime and npm package access\n- Automatic retry on errors\n- Results persisted for replay\n\nBy default, steps have a maximum of 3 retry attempts before they fail and propagate the error to the workflow. Learn more about errors and retrying in the [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries) page.\n\n**Important:** Due to serialization, parameters are passed by **value, not by reference**. If you pass an object or array to a step and mutate it, those changes will **not** be visible in the workflow context. Always return modified data from your step functions instead. See [Pass-by-Value Semantics](https://useworkflow.dev/docs/foundations/serialization#pass-by-value-semantics) for details and examples.\n\nStep functions are primarily meant to be used inside a workflow.\n\nCalling a step from outside a workflow or from another step will essentially run the step in the same process like a normal function (in other words, the `use step` directive is a no-op). This means you can reuse step functions in other parts of your codebase without needing to duplicate business logic.\n\n```\nasync function updateUser(userId: string) {\n  \"use step\";\n  await db.insert(...);\n}\n\n// Used inside a workflow\nexport async function userOnboardingWorkflow(userId: string) {\n  \"use workflow\";\n  await updateUser(userId);\n  // ... more steps\n}\n\n// Used directly outside a workflow\nexport async function POST() {\n  await updateUser(\"123\");\n  // ... more logic\n}\n```\n\nKeep in mind that calling a step function outside of a workflow function will not have retry semantics, nor will it be observable. Additionally, certain workflow-specific functions like [`getStepMetadata()`](https://useworkflow.dev/docs/api-reference/workflow/get-step-metadata) will throw an error when used inside a step that's called outside a workflow.\n\n### [Suspension and Resumption](https://useworkflow.dev/docs/foundations/workflows-and-steps\\#suspension-and-resumption)\n\nWorkflow functions have the ability to automatically suspend while they wait on asynchronous work. While suspended, the workflow's state is stored via the [event log](https://useworkflow.dev/docs/how-it-works/event-sourcing) and no compute resources are used until the workflow resumes execution.\n\nThere are multiple ways a workflow can suspend:\n\n- Waiting on a step function: the workflow yields while the step runs in the step runtime.\n- Using `sleep()` to pause for some fixed duration.\n- Awaiting on a promise returned by [`createWebhook()`](https://useworkflow.dev/docs/api-reference/workflow/create-webhook), which resumes the workflow when an external system passes data into the workflow.\n\n```\nimport { sleep, createWebhook } from \"workflow\";\n\nexport async function documentReviewProcess(userId: string) {\n  \"use workflow\";\n\n  await sleep(\"1 month\"); // Sleep will suspend without consuming any resources\n\n  // Create a webhook for external workflow resumption\n  const webhook = createWebhook();\n\n  // Send the webhook url to some external service or in an email, etc.\n  await sendHumanApprovalEmail(\"Click this link to accept the review\", webhook.url)\n\n  const data = await webhook; // The workflow suspends till the URL is resumed\n\n  console.log(\"Document reviewed!\")\n}\n```\n\n## [Writing Workflows](https://useworkflow.dev/docs/foundations/workflows-and-steps\\#writing-workflows)\n\n### [Basic Structure](https://useworkflow.dev/docs/foundations/workflows-and-steps\\#basic-structure)\n\nThe simplest workflow consists of a workflow function and one or more step functions.\n\n```\n// Workflow function (orchestrates the steps)\nexport async function greetingWorkflow(name: string) {\n  \"use workflow\";\n\n  const message = await greet(name);\n  return { message };\n}\n\n// Step function (does the actual work)\nasync function greet(name: string) {\n  \"use step\";\n\n  // Access Node.js APIs\n  const message = `Hello ${name} at ${new Date().toISOString()}`;\n  console.log(message);\n  return message;\n}\n```\n\n### [Project structure](https://useworkflow.dev/docs/foundations/workflows-and-steps\\#project-structure)\n\nWhile you can organize workflow and step functions however you like, we find that larger projects benefit from some structure:\n\nworkflows\n\nuserOnboarding\n\nindex.ts\n\nsteps.ts\n\naiVideoGeneration\n\nindex.ts\n\nsteps\n\ntranscribeUpload.ts\n\ngenerateVideo.ts\n\nnotifyUser.ts\n\nshared\n\nvalidateInput.ts\n\nlogActivity.ts\n\nYou can choose to organize your steps into a single `steps.ts` file or separate files within a `steps` folder. The `shared` folder is a good place to put common steps that are used by multiple workflows.\n\nSplitting up steps and workflows will also help avoid most bundler related bugs with the Workflow DevKit.\n\n[Foundations\\\\\n\\\\\nPrevious Page](https://useworkflow.dev/docs/foundations) [Starting Workflows\\\\\n\\\\\nNext Page](https://useworkflow.dev/docs/foundations/starting-workflows)\n\nOn this page\n\n[Workflow Functions](https://useworkflow.dev/docs/foundations/workflows-and-steps#workflow-functions) [Step Functions](https://useworkflow.dev/docs/foundations/workflows-and-steps#step-functions) [Suspension and Resumption](https://useworkflow.dev/docs/foundations/workflows-and-steps#suspension-and-resumption) [Writing Workflows](https://useworkflow.dev/docs/foundations/workflows-and-steps#writing-workflows) [Basic Structure](https://useworkflow.dev/docs/foundations/workflows-and-steps#basic-structure) [Project structure](https://useworkflow.dev/docs/foundations/workflows-and-steps#project-structure)\n\n[GitHubEdit this page on GitHub](https://github.com/vercel/workflow/edit/main/content/docs/foundations/workflows-and-steps.mdx) Scroll to topGive feedbackCopy pageAsk AI about this pageOpen in chat\n\n## Chat\n\nWhat is Workflow?How does retrying work?What control flow patterns are there?How do directives work?How do I build an AI agent?\n\nTip: You can open and close chat with `⌘I`\n\n0 / 1000",
  "metadata": {
    "title": "Workflows and Steps",
    "viewport": "width=device-width, initial-scale=1",
    "next-size-adjust": "",
    "ogTitle": "Workflows and Steps",
    "language": "en",
    "og:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "twitter:title": "Workflows and Steps",
    "twitter:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "twitter:card": "summary_large_image",
    "twitter:image:width": "1200",
    "og:title": "Workflows and Steps",
    "og:image:width": "1200",
    "twitter:image:height": "628",
    "og:image:type": "image/png",
    "twitter:image:type": "image/png",
    "ogImage": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "og:image:height": "628",
    "favicon": "https://useworkflow.dev/favicon.ico?favicon.e7ce0d1c.ico",
    "scrapeId": "019bf2d4-569c-75d7-940f-98dc3a41e5a0",
    "sourceURL": "https://useworkflow.dev/docs/foundations/workflows-and-steps",
    "url": "https://useworkflow.dev/docs/foundations/workflows-and-steps",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "proxyUsed": "basic",
    "cacheState": "hit",
    "cachedAt": "2026-01-24T22:01:12.492Z",
    "creditsUsed": 1
  }
}