{
  "markdown": "[Vercel](https://vercel.com/) Slash [Workflow DevKit LogoWorkflow](https://useworkflow.dev/)\n\n- [Docs](https://useworkflow.dev/docs)\n- [Examples](https://github.com/vercel/workflow-examples)\n\n[X](https://x.com/workflowdevkit) [GitHub](https://github.com/vercel/workflow) Search... `⌘K`Ask AI\n\nAsk AI\n\nSearch... `⌘K`\n\n[Getting Started](https://useworkflow.dev/docs/getting-started)\n\n- [Next.js](https://useworkflow.dev/docs/getting-started/next)\n- [Vite](https://useworkflow.dev/docs/getting-started/vite)\n- [Astro](https://useworkflow.dev/docs/getting-started/astro)\n- [Express](https://useworkflow.dev/docs/getting-started/express)\n- [Fastify](https://useworkflow.dev/docs/getting-started/fastify)\n- [Hono](https://useworkflow.dev/docs/getting-started/hono)\n- [Nitro](https://useworkflow.dev/docs/getting-started/nitro)\n- [Nuxt](https://useworkflow.dev/docs/getting-started/nuxt)\n- [SvelteKit](https://useworkflow.dev/docs/getting-started/sveltekit)\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps)\n- [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows)\n- [Control Flow Patterns](https://useworkflow.dev/docs/foundations/control-flow-patterns)\n- [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries)\n- [Hooks & Webhooks](https://useworkflow.dev/docs/foundations/hooks)\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming)\n- [Serialization](https://useworkflow.dev/docs/foundations/serialization)\n- [Idempotency](https://useworkflow.dev/docs/foundations/idempotency)\n\nHow it works\n\n[Observability](https://useworkflow.dev/docs/observability)\n\nAI Agents\n\n- [Building Durable AI Agents](https://useworkflow.dev/docs/ai)\n- [Streaming Updates from Tools](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n- [Resumable Streams](https://useworkflow.dev/docs/ai/resumable-streams)\n- [Sleep, Suspense, and Scheduling](https://useworkflow.dev/docs/ai/sleep-and-delays)\n- [Human-in-the-Loop](https://useworkflow.dev/docs/ai/human-in-the-loop)\n- [Patterns for Defining Tools](https://useworkflow.dev/docs/ai/defining-tools)\n- [Chat Session Modeling](https://useworkflow.dev/docs/ai/chat-session-modeling)\n\n[Deploying](https://useworkflow.dev/docs/deploying)\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n[API Reference](https://useworkflow.dev/docs/api-reference)\n\nControl Flow PatternsSequential Execution\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n# Control Flow Patterns\n\nCommon distributed control flow patterns are simple to implement in workflows and require learning no new syntax. You can just use familiar async/await patterns.\n\n## [Sequential Execution](https://useworkflow.dev/docs/foundations/control-flow-patterns\\#sequential-execution)\n\nThe simplest way to orchestrate steps is to execute them one after another, where each step can be dependent on the previous step.\n\n```\nexport async function dataPipelineWorkflow(data: any) {\n  \"use workflow\";\n\n  const validated = await validateData(data);\n  const processed = await processData(validated);\n  const stored = await storeData(processed);\n\n  return stored;\n}\n```\n\n## [Parallel Execution](https://useworkflow.dev/docs/foundations/control-flow-patterns\\#parallel-execution)\n\nWhen you need to execute multiple steps in parallel, you can use `Promise.all` to run them all at the same time.\n\n```\nexport async function fetchUserData(userId: string) {\n  \"use workflow\";\n\n  const [user, orders, preferences] = await Promise.all([\\\n    fetchUser(userId),\\\n    fetchOrders(userId),\\\n    fetchPreferences(userId)\\\n  ]);\n\n  return { user, orders, preferences };\n}\n```\n\nThis not only applies to steps—since [`sleep()`](https://useworkflow.dev/docs/api-reference/workflow/sleep) and [`webhook`](https://useworkflow.dev/docs/api-reference/workflow/create-webhook) are also just promises, we can await those in parallel too.\nWe can also use `Promise.race` instead of `Promise.all` to stop executing promises after the first one completes.\n\n```\n\nimport { sleep, createWebhook } from \"workflow\";\n\nexport async function runExternalTask(userId: string) {\n  \"use workflow\";\n\n  const webhook = createWebhook();\n  await executeExternalTask(webhook.url); // Send the webhook somewhere\n\n  // Wait for the external webhook to be hit, with a timeout of 1 day,\n  // whichever comes first\n  await Promise.race([\\\n    webhook,\\\n    sleep(\"1 day\"),\\\n  ]);\n\n  console.log(\"Done\")\n}\n```\n\n## [A full example](https://useworkflow.dev/docs/foundations/control-flow-patterns\\#a-full-example)\n\nHere's a simplified example taken from the [birthday card generator demo](https://github.com/vercel/workflow-examples/tree/main/birthday-card-generator), to illustrate how more complex orchestration can be modelled in promises.\n\n```\nimport { createWebhook, sleep } from \"workflow\"\n\nasync function birthdayWorkflow(\n    prompt: string,\n    email: string,\n    friends: string[],\n    birthday: Date\n) {\n    \"use workflow\";\n\n    // Generate a birthday card with sequential steps\n    const text = await makeCardText(prompt)\n    const image = await makeCardImage(text)\n\n    // Create webhooks for each friend who's invited to the birthday party\n    const webhooks = friends.map(_ => createWebhook())\n\n    // Send out all the RSVP invites in parallel steps\n    await Promise.all(\n        friends.map(\n            (friend, i) => sendRSVPEmail(friend, webhooks[i])\n        )\n    )\n\n    // Collect RSVPs as they are made without blocking the workflow\n    let rsvps = []\n    webhooks.map(\n        webhook => webhook\n            .then(req => req.json())\n            .then(( { rsvp } ) => rsvps.push(rsvp))\n    )\n\n    // Wait until the birthday\n    await sleep(birthday)\n\n    // Send birthday card with as many rsvps were collected\n    await sendBirthdayCard(text, image, rsvps, email)\n\n    return { text, image, status: \"Sent\" }\n}\n```\n\n[Starting Workflows\\\\\n\\\\\nPrevious Page](https://useworkflow.dev/docs/foundations/starting-workflows) [Errors & Retrying\\\\\n\\\\\nNext Page](https://useworkflow.dev/docs/foundations/errors-and-retries)\n\nOn this page\n\n[Sequential Execution](https://useworkflow.dev/docs/foundations/control-flow-patterns#sequential-execution) [Parallel Execution](https://useworkflow.dev/docs/foundations/control-flow-patterns#parallel-execution) [A full example](https://useworkflow.dev/docs/foundations/control-flow-patterns#a-full-example)\n\n[GitHubEdit this page on GitHub](https://github.com/vercel/workflow/edit/main/content/docs/foundations/control-flow-patterns.mdx) Scroll to topGive feedbackCopy pageAsk AI about this pageOpen in chat\n\n## Chat\n\nWhat is Workflow?How does retrying work?What control flow patterns are there?How do directives work?How do I build an AI agent?\n\nTip: You can open and close chat with `⌘I`\n\n0 / 1000",
  "metadata": {
    "og:title": "Control Flow Patterns",
    "twitter:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "ogImage": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "twitter:card": "summary_large_image",
    "twitter:image:width": "1200",
    "viewport": "width=device-width, initial-scale=1",
    "og:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "twitter:title": "Control Flow Patterns",
    "language": "en",
    "twitter:image:type": "image/png",
    "title": "Control Flow Patterns",
    "og:image:type": "image/png",
    "ogTitle": "Control Flow Patterns",
    "og:image:height": "628",
    "next-size-adjust": "",
    "og:image:width": "1200",
    "twitter:image:height": "628",
    "favicon": "https://useworkflow.dev/favicon.ico?favicon.e7ce0d1c.ico",
    "scrapeId": "019bf2d4-569c-75d7-940f-9c88c49f1fc1",
    "sourceURL": "https://useworkflow.dev/docs/foundations/control-flow-patterns",
    "url": "https://useworkflow.dev/docs/foundations/control-flow-patterns",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "proxyUsed": "basic",
    "cacheState": "hit",
    "cachedAt": "2026-01-24T22:01:09.963Z",
    "creditsUsed": 1
  }
}