{
  "markdown": "[Vercel](https://vercel.com/) Slash [Workflow DevKit LogoWorkflow](https://useworkflow.dev/)\n\n- [Docs](https://useworkflow.dev/docs)\n- [Examples](https://github.com/vercel/workflow-examples)\n\n[X](https://x.com/workflowdevkit) [GitHub](https://github.com/vercel/workflow) Search... `⌘K`Ask AI\n\nAsk AI\n\nSearch... `⌘K`\n\n[Getting Started](https://useworkflow.dev/docs/getting-started)\n\n- [Next.js](https://useworkflow.dev/docs/getting-started/next)\n- [Vite](https://useworkflow.dev/docs/getting-started/vite)\n- [Astro](https://useworkflow.dev/docs/getting-started/astro)\n- [Express](https://useworkflow.dev/docs/getting-started/express)\n- [Fastify](https://useworkflow.dev/docs/getting-started/fastify)\n- [Hono](https://useworkflow.dev/docs/getting-started/hono)\n- [Nitro](https://useworkflow.dev/docs/getting-started/nitro)\n- [Nuxt](https://useworkflow.dev/docs/getting-started/nuxt)\n- [SvelteKit](https://useworkflow.dev/docs/getting-started/sveltekit)\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps)\n- [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows)\n- [Control Flow Patterns](https://useworkflow.dev/docs/foundations/control-flow-patterns)\n- [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries)\n- [Hooks & Webhooks](https://useworkflow.dev/docs/foundations/hooks)\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming)\n- [Serialization](https://useworkflow.dev/docs/foundations/serialization)\n- [Idempotency](https://useworkflow.dev/docs/foundations/idempotency)\n\nHow it works\n\n[Observability](https://useworkflow.dev/docs/observability)\n\nAI Agents\n\n- [Building Durable AI Agents](https://useworkflow.dev/docs/ai)\n- [Streaming Updates from Tools](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n- [Resumable Streams](https://useworkflow.dev/docs/ai/resumable-streams)\n- [Sleep, Suspense, and Scheduling](https://useworkflow.dev/docs/ai/sleep-and-delays)\n- [Human-in-the-Loop](https://useworkflow.dev/docs/ai/human-in-the-loop)\n- [Patterns for Defining Tools](https://useworkflow.dev/docs/ai/defining-tools)\n- [Chat Session Modeling](https://useworkflow.dev/docs/ai/chat-session-modeling)\n\n[Deploying](https://useworkflow.dev/docs/deploying)\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n[API Reference](https://useworkflow.dev/docs/api-reference)\n\nErrors & RetryingDefault Retrying\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n# Errors & Retrying\n\nBy default, errors thrown inside steps are retried. Additionally, Workflow DevKit provides two new types of errors you can use to customize retries.\n\n## [Default Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries\\#default-retrying)\n\nBy default, steps retry up to 3 times on arbitrary errors. You can customize the number of retries by adding a `maxRetries` property to the step function.\n\n```\nasync function callApi(endpoint: string) {\n  \"use step\";\n\n  const response = await fetch(endpoint);\n\n  if (response.status >= 500) {\n    // Any uncaught error gets retried\n    throw new Error(\"Uncaught exceptions get retried!\");\n  }\n\n  return response.json();\n}\n\ncallApi.maxRetries = 5; // Retry up to 5 times on failure (6 total attempts)\n```\n\nSteps get enqueued immediately after a failure. Read on to see how this can be customized.\n\nWhen a retried step performs external side effects (payments, emails, API\nwrites), ensure those calls are **idempotent** to avoid duplicate\nside effects. See [Idempotency](https://useworkflow.dev/docs/foundations/idempotency) for\nmore information.\n\n## [Intentional Errors](https://useworkflow.dev/docs/foundations/errors-and-retries\\#intentional-errors)\n\nWhen your step needs to intentionally throw an error and skip retrying, simply throw a [`FatalError`](https://useworkflow.dev/docs/api-reference/workflow/fatal-error).\n\n```\nimport { FatalError } from \"workflow\";\n\nasync function callApi(endpoint: string) {\n  \"use step\";\n\n  const response = await fetch(endpoint);\n\n  if (response.status >= 500) {\n    // Any uncaught error gets retried\n    throw new Error(\"Uncaught exceptions get retried!\");\n  }\n\n  if (response.status === 404) {\n    throw new FatalError(\"Resource not found. Skipping retries.\");\n  }\n\n  return response.json();\n}\n```\n\n## [Customize Retry Behavior](https://useworkflow.dev/docs/foundations/errors-and-retries\\#customize-retry-behavior)\n\nWhen you need to customize the delay on a retry, use [`RetryableError`](https://useworkflow.dev/docs/api-reference/workflow/retryable-error) and set the `retryAfter` property.\n\n```\nimport { FatalError, RetryableError } from \"workflow\";\n\nasync function callApi(endpoint: string) {\n  \"use step\";\n\n  const response = await fetch(endpoint);\n\n  if (response.status >= 500) {\n    throw new Error(\"Uncaught exceptions get retried!\");\n  }\n\n  if (response.status === 404) {\n    throw new FatalError(\"Resource not found. Skipping retries.\");\n  }\n\n  if (response.status === 429) {\n    throw new RetryableError(\"Rate limited. Retrying...\", {\n      retryAfter: \"1m\", // Duration string\n    });\n  }\n\n  return response.json();\n}\n```\n\n## [Advanced Example](https://useworkflow.dev/docs/foundations/errors-and-retries\\#advanced-example)\n\nThis final example combines everything we've learned, along with [`getStepMetadata`](https://useworkflow.dev/docs/api-reference/workflow/get-step-metadata).\n\n```\nimport { FatalError, RetryableError, getStepMetadata } from \"workflow\";\n\nasync function callApi(endpoint: string) {\n  \"use step\";\n\n  const metadata = getStepMetadata();\n\n  const response = await fetch(endpoint);\n\n  if (response.status >= 500) {\n    // Exponential backoffs\n    throw new RetryableError(\"Backing off...\", {\n      retryAfter: (metadata.attempt ** 2) * 1000,\n    });\n  }\n\n  if (response.status === 404) {\n    throw new FatalError(\"Resource not found. Skipping retries.\");\n  }\n\n  if (response.status === 429) {\n    throw new RetryableError(\"Rate limited. Retrying...\", {\n      retryAfter: new Date(Date.now() + 60000),  // Date instance\n    });\n  }\n\n  return response.json();\n}\ncallApi.maxRetries = 5; // Retry up to 5 times on failure (6 total attempts)\n```\n\nSetting `maxRetries = 0` means the step will run once but will not\nbe retried on failure. The default is `maxRetries = 3`, meaning the\nstep can run up to 4 times total (1 initial attempt + 3 retries).\n\n## [Rolling Back Failed Steps](https://useworkflow.dev/docs/foundations/errors-and-retries\\#rolling-back-failed-steps)\n\nWhen a workflow fails partway through, it can leave the system in an inconsistent state.\nA common pattern to address this is \"rollbacks\": for each successful step, record a corresponding rollback action that can undo it.\nIf a later step fails, run the rollbacks in reverse order to roll back.\n\nKey guidelines:\n\n- Make rollbacks steps as well, so they are durable and benefit from retries.\n- Ensure rollbacks are [idempotent](https://useworkflow.dev/docs/foundations/idempotency); they may run more than once.\n- Only enqueue a compensation after its forward step succeeds.\n\n```\n// Forward steps\nasync function reserveInventory(orderId: string) {\n  \"use step\";\n  // ... call inventory service to reserve ...\n}\n\nasync function chargePayment(orderId: string) {\n  \"use step\";\n  // ... charge the customer ...\n}\n\n// Rollback steps\nasync function releaseInventory(orderId: string) {\n  \"use step\";\n  // ... undo inventory reservation ...\n}\n\nasync function refundPayment(orderId: string) {\n  \"use step\";\n  // ... refund the charge ...\n}\n\nexport async function placeOrderSaga(orderId: string) {\n  \"use workflow\";\n\n  const rollbacks: Array<() => Promise<void>> = [];\n\n  try {\n    await reserveInventory(orderId);\n    rollbacks.push(() => releaseInventory(orderId));\n\n    await chargePayment(orderId);\n    rollbacks.push(() => refundPayment(orderId));\n\n    // ... more steps & rollbacks ...\n  } catch (e) {\n    for (const rollback of rollbacks.reverse()) {\n      await rollback();\n    }\n    // Rethrow so the workflow records the failure after rollbacks\n    throw e;\n  }\n}\n```\n\n[Control Flow Patterns\\\\\n\\\\\nPrevious Page](https://useworkflow.dev/docs/foundations/control-flow-patterns) [Hooks & Webhooks\\\\\n\\\\\nNext Page](https://useworkflow.dev/docs/foundations/hooks)\n\nOn this page\n\n[Default Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries#default-retrying) [Intentional Errors](https://useworkflow.dev/docs/foundations/errors-and-retries#intentional-errors) [Customize Retry Behavior](https://useworkflow.dev/docs/foundations/errors-and-retries#customize-retry-behavior) [Advanced Example](https://useworkflow.dev/docs/foundations/errors-and-retries#advanced-example) [Rolling Back Failed Steps](https://useworkflow.dev/docs/foundations/errors-and-retries#rolling-back-failed-steps)\n\n[GitHubEdit this page on GitHub](https://github.com/vercel/workflow/edit/main/content/docs/foundations/errors-and-retries.mdx) Scroll to topGive feedbackCopy pageAsk AI about this pageOpen in chat\n\n## Chat\n\nWhat is Workflow?How does retrying work?What control flow patterns are there?How do directives work?How do I build an AI agent?\n\nTip: You can open and close chat with `⌘I`\n\n0 / 1000",
  "metadata": {
    "twitter:image:height": "628",
    "next-size-adjust": "",
    "viewport": "width=device-width, initial-scale=1",
    "og:image:width": "1200",
    "og:image:height": "628",
    "twitter:card": "summary_large_image",
    "twitter:title": "Errors & Retrying",
    "twitter:image:width": "1200",
    "title": "Errors & Retrying",
    "ogTitle": "Errors & Retrying",
    "og:title": "Errors & Retrying",
    "twitter:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "language": "en",
    "ogImage": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "og:image:type": "image/png",
    "twitter:image:type": "image/png",
    "og:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "favicon": "https://useworkflow.dev/favicon.ico?favicon.e7ce0d1c.ico",
    "scrapeId": "019bf2d4-569c-75d7-940f-5d249be40481",
    "sourceURL": "https://useworkflow.dev/docs/foundations/errors-and-retries",
    "url": "https://useworkflow.dev/docs/foundations/errors-and-retries",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "proxyUsed": "basic",
    "cacheState": "hit",
    "cachedAt": "2026-01-24T22:00:53.231Z",
    "creditsUsed": 1
  }
}