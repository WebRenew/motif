{
  "markdown": "[Vercel](https://vercel.com/) Slash [Workflow DevKit LogoWorkflow](https://useworkflow.dev/)\n\n- [Docs](https://useworkflow.dev/docs)\n- [Examples](https://github.com/vercel/workflow-examples)\n\n[X](https://x.com/workflowdevkit) [GitHub](https://github.com/vercel/workflow) Search... `⌘K`Ask AI\n\nAsk AI\n\nSearch... `⌘K`\n\n[Getting Started](https://useworkflow.dev/docs/getting-started)\n\n- [Next.js](https://useworkflow.dev/docs/getting-started/next)\n- [Vite](https://useworkflow.dev/docs/getting-started/vite)\n- [Astro](https://useworkflow.dev/docs/getting-started/astro)\n- [Express](https://useworkflow.dev/docs/getting-started/express)\n- [Fastify](https://useworkflow.dev/docs/getting-started/fastify)\n- [Hono](https://useworkflow.dev/docs/getting-started/hono)\n- [Nitro](https://useworkflow.dev/docs/getting-started/nitro)\n- [Nuxt](https://useworkflow.dev/docs/getting-started/nuxt)\n- [SvelteKit](https://useworkflow.dev/docs/getting-started/sveltekit)\n\n[Foundations](https://useworkflow.dev/docs/foundations)\n\n- [Workflows and Steps](https://useworkflow.dev/docs/foundations/workflows-and-steps)\n- [Starting Workflows](https://useworkflow.dev/docs/foundations/starting-workflows)\n- [Control Flow Patterns](https://useworkflow.dev/docs/foundations/control-flow-patterns)\n- [Errors & Retrying](https://useworkflow.dev/docs/foundations/errors-and-retries)\n- [Hooks & Webhooks](https://useworkflow.dev/docs/foundations/hooks)\n- [Streaming](https://useworkflow.dev/docs/foundations/streaming)\n- [Serialization](https://useworkflow.dev/docs/foundations/serialization)\n- [Idempotency](https://useworkflow.dev/docs/foundations/idempotency)\n\nHow it works\n\n[Observability](https://useworkflow.dev/docs/observability)\n\nAI Agents\n\n- [Building Durable AI Agents](https://useworkflow.dev/docs/ai)\n- [Streaming Updates from Tools](https://useworkflow.dev/docs/ai/streaming-updates-from-tools)\n- [Resumable Streams](https://useworkflow.dev/docs/ai/resumable-streams)\n- [Sleep, Suspense, and Scheduling](https://useworkflow.dev/docs/ai/sleep-and-delays)\n- [Human-in-the-Loop](https://useworkflow.dev/docs/ai/human-in-the-loop)\n- [Patterns for Defining Tools](https://useworkflow.dev/docs/ai/defining-tools)\n- [Chat Session Modeling](https://useworkflow.dev/docs/ai/chat-session-modeling)\n\n[Deploying](https://useworkflow.dev/docs/deploying)\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n[API Reference](https://useworkflow.dev/docs/api-reference)\n\nhook-conflictError Message\n\n[Errors](https://useworkflow.dev/docs/errors)\n\n# hook-conflict\n\nThis error occurs when you try to create a hook with a token that is already in use by another active workflow run. Hook tokens must be unique across all running workflows in your project.\n\n## [Error Message](https://useworkflow.dev/docs/errors/hook-conflict\\#error-message)\n\n```\nHook token conflict: Hook with token <token> already exists for this project\n```\n\n## [Why This Happens](https://useworkflow.dev/docs/errors/hook-conflict\\#why-this-happens)\n\nHooks use tokens to identify incoming webhook payloads. When you create a hook with `createHook({ token: \"my-token\" })`, the Workflow runtime reserves that token for your workflow run. If another workflow run is already using that token, a conflict occurs.\n\nThis typically happens when:\n\n1. **Two workflows start simultaneously** with the same hardcoded token\n2. **A previous workflow run is still waiting** for a hook when a new run tries to use the same token\n\n## [Common Causes](https://useworkflow.dev/docs/errors/hook-conflict\\#common-causes)\n\n### [Hardcoded Token Values](https://useworkflow.dev/docs/errors/hook-conflict\\#hardcoded-token-values)\n\n```\n// Error - multiple concurrent runs will conflict\nexport async function processPayment() {\n  \"use workflow\";\n\n  const hook = createHook({ token: \"payment-hook\" });\n  // If another run is already waiting on \"payment-hook\", this will fail\n  const payment = await hook;\n}\n```\n\n**Solution:** Use unique tokens that include the run ID or other unique identifiers.\n\n```\nexport async function processPayment(orderId: string) {\n  \"use workflow\";\n\n  // Include unique identifier in token\n  const hook = createHook({ token: `payment-${orderId}` });\n  const payment = await hook;\n}\n```\n\n### [Omitting the Token (Auto-generated)](https://useworkflow.dev/docs/errors/hook-conflict\\#omitting-the-token-auto-generated)\n\nThe safest approach is to let the Workflow runtime generate a unique token automatically:\n\n```\nexport async function processPayment() {\n  \"use workflow\";\n\n  const hook = createHook(); // Auto-generated unique token\n  console.log(`Send webhook to token: ${hook.token}`);\n  const payment = await hook;\n}\n```\n\n## [Handling Hook Conflicts in Your Workflow](https://useworkflow.dev/docs/errors/hook-conflict\\#handling-hook-conflicts-in-your-workflow)\n\nWhen a hook conflict occurs, awaiting the hook will throw a `WorkflowRuntimeError`. You can catch this error to handle the conflict gracefully:\n\n```\nimport { WorkflowRuntimeError } from \"@workflow/errors\";\n\nexport async function processPayment(orderId: string) {\n  \"use workflow\";\n\n  const hook = createHook({ token: `payment-${orderId}` });\n\n  try {\n    const payment = await hook;\n    return { success: true, payment };\n  } catch (error) {\n    if (error instanceof WorkflowRuntimeError && error.slug === \"hook-conflict\") {\n      // Another workflow is already processing this order\n      return { success: false, reason: \"duplicate-processing\" };\n    }\n    throw error; // Re-throw other errors\n  }\n}\n```\n\nThis pattern is useful when you want to detect and handle duplicate processing attempts instead of letting the workflow fail.\n\n## [When Hook Tokens Are Released](https://useworkflow.dev/docs/errors/hook-conflict\\#when-hook-tokens-are-released)\n\nHook tokens are automatically released when:\n\n- The workflow run **completes** (successfully or with an error)\n- The workflow run is **cancelled**\n- The hook is explicitly **disposed**\n\nAfter a workflow completes, its hook tokens become available for reuse by other workflows.\n\n## [Best Practices](https://useworkflow.dev/docs/errors/hook-conflict\\#best-practices)\n\n1. **Use auto-generated tokens** when possible - they are guaranteed to be unique\n2. **Include unique identifiers** if you need custom tokens (order ID, user ID, etc.)\n3. **Avoid reusing the same token** across multiple concurrent workflow runs\n4. **Consider using webhooks** (`createWebhook`) if you need a fixed, predictable URL that can receive multiple payloads\n\n## [Related](https://useworkflow.dev/docs/errors/hook-conflict\\#related)\n\n- [Hooks](https://useworkflow.dev/docs/foundations/hooks) \\- Learn more about using hooks in workflows\n- [createWebhook](https://useworkflow.dev/docs/api-reference/workflow/create-webhook) \\- Alternative for fixed webhook URLs\n\n[fetch-in-workflow\\\\\n\\\\\nPrevious Page](https://useworkflow.dev/docs/errors/fetch-in-workflow) [node-js-module-in-workflow\\\\\n\\\\\nNext Page](https://useworkflow.dev/docs/errors/node-js-module-in-workflow)\n\nOn this page\n\n[Error Message](https://useworkflow.dev/docs/errors/hook-conflict#error-message) [Why This Happens](https://useworkflow.dev/docs/errors/hook-conflict#why-this-happens) [Common Causes](https://useworkflow.dev/docs/errors/hook-conflict#common-causes) [Hardcoded Token Values](https://useworkflow.dev/docs/errors/hook-conflict#hardcoded-token-values) [Omitting the Token (Auto-generated)](https://useworkflow.dev/docs/errors/hook-conflict#omitting-the-token-auto-generated) [Handling Hook Conflicts in Your Workflow](https://useworkflow.dev/docs/errors/hook-conflict#handling-hook-conflicts-in-your-workflow) [When Hook Tokens Are Released](https://useworkflow.dev/docs/errors/hook-conflict#when-hook-tokens-are-released) [Best Practices](https://useworkflow.dev/docs/errors/hook-conflict#best-practices) [Related](https://useworkflow.dev/docs/errors/hook-conflict#related)\n\n[GitHubEdit this page on GitHub](https://github.com/vercel/workflow/edit/main/content/docs/errors/hook-conflict.mdx) Scroll to topGive feedbackCopy pageAsk AI about this pageOpen in chat\n\n## Chat\n\nWhat is Workflow?How does retrying work?What control flow patterns are there?How do directives work?How do I build an AI agent?\n\nTip: You can open and close chat with `⌘I`\n\n0 / 1000",
  "metadata": {
    "twitter:image:height": "628",
    "twitter:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "viewport": "width=device-width, initial-scale=1",
    "twitter:image:type": "image/png",
    "og:image:height": "628",
    "og:image:type": "image/png",
    "next-size-adjust": "",
    "og:image": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "ogTitle": "hook-conflict",
    "title": "hook-conflict",
    "language": "en",
    "og:title": "hook-conflict",
    "og:image:width": "1200",
    "twitter:image:width": "1200",
    "twitter:title": "hook-conflict",
    "twitter:card": "summary_large_image",
    "ogImage": "https://useworkflow.dev/opengraph-image.png?opengraph-image.f38670ff.png",
    "favicon": "https://useworkflow.dev/favicon.ico?favicon.e7ce0d1c.ico",
    "scrapeId": "019bf2d4-57d5-727e-b359-75c55fa04750",
    "sourceURL": "https://useworkflow.dev/docs/errors/hook-conflict",
    "url": "https://useworkflow.dev/docs/errors/hook-conflict",
    "statusCode": 200,
    "contentType": "text/html; charset=utf-8",
    "timezone": "America/New_York",
    "proxyUsed": "basic",
    "cacheState": "miss",
    "indexId": "29b2b012-1e1a-4b75-acaf-697c6e09eb66",
    "creditsUsed": 1
  }
}